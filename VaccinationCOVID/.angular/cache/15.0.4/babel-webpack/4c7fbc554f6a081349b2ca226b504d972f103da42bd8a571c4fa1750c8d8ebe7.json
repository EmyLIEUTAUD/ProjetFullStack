{"ast":null,"code":"import * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"../_services/authentication.service\";\nimport * as i3 from \"../_services/token-storage.service\";\nimport * as i4 from \"@angular/common\";\nimport * as i5 from \"@angular/forms\";\nfunction LoginComponent_form_8_div_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 20);\n    i0.ɵɵtext(1, \" Votre adresse username est necessaire! \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction LoginComponent_form_8_div_13_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtext(1, \"Veuillez saisir votre mot de passe\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction LoginComponent_form_8_div_13_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtext(1, \" Votre mot de passe doit contenir au moins de 6 caract\\u00E8res \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction LoginComponent_form_8_div_13_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 20);\n    i0.ɵɵtemplate(1, LoginComponent_form_8_div_13_div_1_Template, 2, 0, \"div\", 21);\n    i0.ɵɵtemplate(2, LoginComponent_form_8_div_13_div_2_Template, 2, 0, \"div\", 21);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    i0.ɵɵnextContext();\n    const _r5 = i0.ɵɵreference(12);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", _r5.errors.required);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", _r5.errors.minlength);\n  }\n}\nfunction LoginComponent_form_8_div_18_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 20);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r7 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" Login failed: \", ctx_r7.errorMessage, \" \");\n  }\n}\nfunction LoginComponent_form_8_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r11 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"form\", 9, 10);\n    i0.ɵɵlistener(\"ngSubmit\", function LoginComponent_form_8_Template_form_ngSubmit_0_listener() {\n      i0.ɵɵrestoreView(_r11);\n      const _r2 = i0.ɵɵreference(1);\n      const ctx_r10 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(_r2.form.valid && ctx_r10.onSubmit());\n    });\n    i0.ɵɵelementStart(2, \"div\", 11)(3, \"label\", 12);\n    i0.ɵɵtext(4, \"Username\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"input\", 13, 14);\n    i0.ɵɵlistener(\"ngModelChange\", function LoginComponent_form_8_Template_input_ngModelChange_5_listener($event) {\n      i0.ɵɵrestoreView(_r11);\n      const ctx_r12 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r12.form.username = $event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(7, LoginComponent_form_8_div_7_Template, 2, 0, \"div\", 15);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"div\", 11)(9, \"label\", 16);\n    i0.ɵɵtext(10, \"Password\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"input\", 17, 18);\n    i0.ɵɵlistener(\"ngModelChange\", function LoginComponent_form_8_Template_input_ngModelChange_11_listener($event) {\n      i0.ɵɵrestoreView(_r11);\n      const ctx_r13 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r13.form.password = $event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(13, LoginComponent_form_8_div_13_Template, 3, 2, \"div\", 15);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(14, \"div\", 11)(15, \"button\", 19);\n    i0.ɵɵtext(16, \" Login \");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(17, \"div\", 11);\n    i0.ɵɵtemplate(18, LoginComponent_form_8_div_18_Template, 2, 1, \"div\", 15);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const _r2 = i0.ɵɵreference(1);\n    const _r3 = i0.ɵɵreference(6);\n    const _r5 = i0.ɵɵreference(12);\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngModel\", ctx_r0.form.username);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", _r3.errors && _r2.submitted);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngModel\", ctx_r0.form.password);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", _r5.errors && _r2.submitted);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngIf\", _r2.submitted && ctx_r0.isLoginFailed);\n  }\n}\nfunction LoginComponent_div_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 22);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" Logged in as \", ctx_r1.roles, \". \");\n  }\n}\nexport class LoginComponent {\n  constructor(router, authenticationService, tokenStorage) {\n    this.router = router;\n    this.authenticationService = authenticationService;\n    this.tokenStorage = tokenStorage;\n    this.error = '';\n    this.isLoggedIn = false;\n    this.isLoginFailed = false;\n    this.roles = [];\n    this.errorMessage = '';\n    this.form = {\n      username: null,\n      password: null\n    };\n  }\n  ngOnInit() {\n    if (this.tokenStorage.getToken()) {\n      this.isLoggedIn = true;\n      this.roles = this.tokenStorage.getUser().scopes;\n      this.router.navigate(['']);\n    }\n  }\n  onSubmit() {\n    const {\n      username,\n      password\n    } = this.form;\n    this.authenticationService.login(username, password).subscribe({\n      next: data => {\n        this.tokenStorage.saveToken(data.accessToken);\n        this.tokenStorage.saveUser(data);\n        this.isLoginFailed = false;\n        this.isLoggedIn = true;\n        this.roles = this.tokenStorage.getUser().scopes;\n        this.reloadPage();\n      },\n      error: err => {\n        this.errorMessage = err.error.message;\n        this.isLoginFailed = true;\n      }\n    });\n  }\n  reloadPage() {\n    window.location.reload();\n  }\n}\nLoginComponent.ɵfac = function LoginComponent_Factory(t) {\n  return new (t || LoginComponent)(i0.ɵɵdirectiveInject(i1.Router), i0.ɵɵdirectiveInject(i2.AuthenticationService), i0.ɵɵdirectiveInject(i3.TokenStorageService));\n};\nLoginComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: LoginComponent,\n  selectors: [[\"app-login\"]],\n  decls: 10,\n  vars: 2,\n  consts: [[1, \"vh-100\"], [1, \"container\", \"py-5\", \"h-100\"], [1, \"row\", \"d-flex\", \"justify-content-center\", \"align-items-center\", \"h-100\"], [1, \"col-12\", \"col-md-8\", \"col-lg-6\", \"col-xl-5\"], [1, \"card\", \"shadow-2-strong\", 2, \"border-radius\", \"1rem\"], [1, \"card-body\", \"p-5\", \"text-center\"], [1, \"mb-5\"], [\"name\", \"form\", \"novalidate\", \"\", 3, \"ngSubmit\", 4, \"ngIf\"], [\"class\", \"alert alert-success\", 4, \"ngIf\"], [\"name\", \"form\", \"novalidate\", \"\", 3, \"ngSubmit\"], [\"f\", \"ngForm\"], [1, \"form-group\"], [\"for\", \"username\"], [\"type\", \"text\", \"name\", \"username\", \"required\", \"\", 1, \"form-control\", 3, \"ngModel\", \"ngModelChange\"], [\"username\", \"ngModel\"], [\"class\", \"alert alert-danger\", \"role\", \"alert\", 4, \"ngIf\"], [\"for\", \"password\"], [\"type\", \"password\", \"name\", \"password\", \"required\", \"\", \"minlength\", \"6\", 1, \"form-control\", 3, \"ngModel\", \"ngModelChange\"], [\"password\", \"ngModel\"], [1, \"btn\", \"btn-primary\", \"btn-block\"], [\"role\", \"alert\", 1, \"alert\", \"alert-danger\"], [4, \"ngIf\"], [1, \"alert\", \"alert-success\"]],\n  template: function LoginComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"section\", 0)(1, \"div\", 1)(2, \"div\", 2)(3, \"div\", 3)(4, \"div\", 4)(5, \"div\", 5)(6, \"h3\", 6);\n      i0.ɵɵtext(7, \"Log in\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵtemplate(8, LoginComponent_form_8_Template, 19, 5, \"form\", 7);\n      i0.ɵɵtemplate(9, LoginComponent_div_9_Template, 2, 1, \"div\", 8);\n      i0.ɵɵelementEnd()()()()()();\n    }\n    if (rf & 2) {\n      i0.ɵɵadvance(8);\n      i0.ɵɵproperty(\"ngIf\", !ctx.isLoggedIn);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.isLoggedIn);\n    }\n  },\n  dependencies: [i4.NgIf, i5.ɵNgNoValidate, i5.DefaultValueAccessor, i5.NgControlStatus, i5.NgControlStatusGroup, i5.RequiredValidator, i5.MinLengthValidator, i5.NgModel, i5.NgForm],\n  encapsulation: 2\n});","map":{"version":3,"mappings":"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","names":["i0","ctx_r10","LoginComponent","constructor","router","authenticationService","tokenStorage","username","password","ngOnInit","getToken","isLoggedIn","roles","getUser","scopes","navigate","onSubmit","form","login","subscribe","next","data","saveToken","accessToken","saveUser","isLoginFailed","reloadPage","error","err","errorMessage","message","window","location","reload","selectors","decls","vars","consts","template"],"sourceRoot":"","sources":["C:\\Users\\yunqi\\IdeaProjet\\ProjetFullStack\\VaccinationCOVID\\src\\app\\login\\login.component.html","C:\\Users\\yunqi\\IdeaProjet\\ProjetFullStack\\VaccinationCOVID\\src\\app\\login\\login.component.ts"],"sourcesContent":["<section class=\"vh-100\" >\r\n  <div class=\"container py-5 h-100\">\r\n    <div class=\"row d-flex justify-content-center align-items-center h-100\">\r\n      <div class=\"col-12 col-md-8 col-lg-6 col-xl-5\">\r\n        <div class=\"card shadow-2-strong\" style=\"border-radius: 1rem;\">\r\n          <div class=\"card-body p-5 text-center\">\r\n            <h3 class=\"mb-5\">Log in</h3>\r\n      <form\r\n        *ngIf=\"!isLoggedIn\"\r\n        name=\"form\"\r\n        (ngSubmit)=\"f.form.valid && onSubmit()\"\r\n        #f=\"ngForm\"\r\n        novalidate\r\n      >\r\n        <div class=\"form-group\">\r\n          <label for=\"username\">Username</label>\r\n          <input\r\n            type=\"text\"\r\n            class=\"form-control\"\r\n            name=\"username\"\r\n            [(ngModel)]=\"form.username\"\r\n            required\r\n            #username=\"ngModel\"\r\n          />\r\n          <div\r\n            class=\"alert alert-danger\"\r\n            role=\"alert\"\r\n            *ngIf=\"username.errors && f.submitted\"\r\n          >\r\n            Votre adresse username est necessaire!\r\n          </div>\r\n        </div>\r\n        <div class=\"form-group\">\r\n          <label for=\"password\">Password</label>\r\n          <input\r\n            type=\"password\"\r\n            class=\"form-control\"\r\n            name=\"password\"\r\n            [(ngModel)]=\"form.password\"\r\n            required\r\n            minlength=\"6\"\r\n            #password=\"ngModel\"\r\n          />\r\n          <div\r\n            class=\"alert alert-danger\"\r\n            role=\"alert\"\r\n            *ngIf=\"password.errors && f.submitted\"\r\n          >\r\n            <div *ngIf=\"password.errors.required\">Veuillez saisir votre mot de passe</div>\r\n            <div *ngIf=\"password.errors.minlength\">\r\n              Votre mot de passe doit contenir au moins de 6 caractères\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div class=\"form-group\">\r\n          <button class=\"btn btn-primary btn-block\">\r\n            Login\r\n          </button>\r\n        </div>\r\n        <div class=\"form-group\">\r\n          <div\r\n            class=\"alert alert-danger\"\r\n            role=\"alert\"\r\n            *ngIf=\"f.submitted && isLoginFailed\"\r\n          >\r\n            Login failed: {{ errorMessage }}\r\n          </div>\r\n        </div>\r\n      </form>\r\n  \r\n      <div class=\"alert alert-success\" *ngIf=\"isLoggedIn\">\r\n        Logged in as {{ roles }}.\r\n      </div>\r\n    </div>  \r\n  </div>\r\n</div>\r\n</div>\r\n</div>\r\n  </section>\r\n","import { Component, OnInit } from '@angular/core';\r\nimport { Router, ActivatedRoute } from '@angular/router';\r\nimport { FormBuilder, FormGroup, Validators } from '@angular/forms';\r\nimport { first } from 'rxjs/operators';\r\nimport { AuthenticationService } from '../_services/authentication.service';\r\nimport { TokenStorageService } from '../_services/token-storage.service';\r\n\r\n@Component({  \r\n    selector: 'app-login',\r\n    templateUrl:'./login.component.html' })\r\nexport class LoginComponent implements OnInit {\r\n    \r\n    error = '';\r\n    isLoggedIn = false;\r\n    isLoginFailed = false;\r\n    roles: string[] = [];\r\n    errorMessage = '';\r\n\r\n    form: any = {\r\n        username: null,\r\n        password: null\r\n      };\r\n    constructor(\r\n      private router: Router,\r\n        private authenticationService: AuthenticationService,\r\n        private tokenStorage: TokenStorageService\r\n    ) {}\r\n\r\n\r\n    ngOnInit(): void {\r\n        if (this.tokenStorage.getToken()) {\r\n          this.isLoggedIn = true;\r\n          this.roles = this.tokenStorage.getUser().scopes;\r\n          this.router.navigate([''])\r\n\r\n        }\r\n      }\r\n  \r\n    onSubmit(): void {\r\n        const { username, password } = this.form;\r\n    \r\n        this.authenticationService.login(username, password).subscribe({\r\n          next : (data) => {\r\n            this.tokenStorage.saveToken(data.accessToken);\r\n            this.tokenStorage.saveUser(data);\r\n    \r\n            this.isLoginFailed = false;\r\n            this.isLoggedIn = true;\r\n            this.roles = this.tokenStorage.getUser().scopes;\r\n            this.reloadPage();\r\n          },\r\n          error : (err) => {\r\n            this.errorMessage = err.error.message;\r\n            this.isLoginFailed = true;\r\n          }\r\n    });\r\n      }\r\n      reloadPage(): void {\r\n        window.location.reload();\r\n      }\r\n}\r\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}